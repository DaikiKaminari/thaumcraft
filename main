--- CONFIG ---
local centerPedestalName = "container_pedestal_12"
local chestName = "tile_extrautils_chestfull_name_2"

--- GLOBAL VARIABLES ---
local centerPedestal    -- table : peripheral - the center pedestal
local pedestals = {}    -- table : peripherals - all pedestals
local chest             -- table : peripheral - input chest

--- INIT ---
local function periphInit()
    centerPedestal = peripheral.wrap(centerPedestalName)
    if centerPedestal == nil then
        error("Center pedestal missing or wrong number : " .. centerPedestalNumber)
    end
    local i = 1
    for _,v in pairs(peripheral.getNames()) do
        if v:find("container_pedestal") ~= nil then
            pedestals[i] = peripheral.wrap(v)
            i = i + 1
        end
    end
    if #pedestals < 12 then
        error("Missing pedestals, only [" .. tostring(#pedestals) .. "] were found.")
    end
    chest = peripheral.wrap(chestName)
    if chest == nil then
        error("Chest missing or wrong config : [" .. chestName .. "].")
    end
end

-- Load apis and execute init() method if it exists
local function init(apis)
    for _,path in pairs(apis) do
        if not fs.exists(path) then
            error("API [" .. path .. "] does not exist.")
        end
        print("\nLoading API : [" .. path .. "]")
        os.loadAPI(path)
    end
    for _,path in pairs(apis) do
        local api
        for v in path:gmatch("([^/]+)") do
            api = v
        end
        if _G[api].init ~= nil then
            _G[api].init()
        end
    end
end

--- UTILS ---

--- FUNCTIONS ---
-- manage the altar for autocrafting
local function altarManager()

end

-- process an item in the altar
local function processItem()

end

-- main call
local function main()
    init({"lib/objectJSON", "recipeManager"})
    periphInit()

    io.read()
    local inputItems = chest.getAllStacks()
    local r = recipeManager.getMatchingRecipe(inputItems)
    if r == nil then
        print("No recipe found.")
    else
        print(textutils.serialise(r))
    end
end

main()